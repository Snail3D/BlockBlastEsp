#B
import network,socket,gc
SSID="BlockBlast-ESP32"
HTML=b"""<!DOCTYPE html><html><head><meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1,user-scalable=no\"><title>Block Blast</title><style>*{margin:0;padding:0;touch-action:none}body{font-family:sans-serif;background:#1a1a2e;min-height:100vh;display:flex;justify-content:center;align-items:center;padding:10px}#game{max-width:360px}.header{display:flex;justify-content:space-between;margin-bottom:10px}.score-box{background:rgba(255,255,255,0.1);border-radius:10px;padding:8px 16px;text-align:center}.score-label{font-size:10px;font-weight:700;color:#88ccff}.score-value{font-size:20px;font-weight:700;color:#fff}#canvas{background:#2a2a4a;border-radius:8px}#pieces{display:flex;gap:10px;justify-content:center;margin-top:15px}.piece-slot{width:60px;height:60px;background:#3a3a5a;border-radius:8px;display:flex;align-items:center;justify-content:center}.piece-slot canvas{cursor:grab}.combo{position:absolute;font-size:24px;font-weight:700;color:#ffdd00;text-shadow:0 0 10px rgba(255,221,0,0.8);pointer-events:none;opacity:0;transition:opacity 0.3s}.combo.show{opacity:1}</style></head><body><div id=\"game\"><div class=\"header\"><div class=\"score-box\"><div class=\"score-label\">SCORE</div><div class=\"score-value\" id=\"score\">0</div></div><div class=\"score-box\"><div class=\"score-label\">BEST</div><div class=\"score-value\" id=\"best\">0</div></div></div><div style=\"position:relative\"><canvas id=\"canvas\" width=\"320\" height=\"320\"></canvas><div class=\"combo\" id=\"combo\"></div></div><div id=\"pieces\"></div></div><script>const G=8,CS=40;const C={cyan:'#00d4aa',blue:'#00a8cc',orange:'#ff8c42',yellow:'#ffdd00',green:'#7ec850',red:'#ff5252',purple:'#a855f7',pink:'#ff6b9d'};const P=[[{shape:[[1]],color:C.cyan},{shape:[[1,1]],color:C.blue},{shape:[[1],[1]],color:C.blue},{shape:[[1,1,1]],color:C.green},{shape:[[1],[1],[1]],color:C.green},{shape:[[1,1,1,1]],color:C.orange},{shape:[[1],[1],[1],[1]],color:C.orange},{shape:[[1,1],[1,1],[1,1]],color:C.red},{shape:[[1],[1],[1],[1],[1],[1]],color:C.red},{shape:[[1,1],[1,1],[1,1],[1,1],[1,1]],color:C.pink},{shape:[[1,1],[1,1]],color:C.yellow},{shape:[[1,1],[1,1]],color:C.purple},{shape:[[1,0],[1,0],[1,1]],color:C.red},{shape:[[1,1,1],[1,0,0]],color:C.red},{shape:[[0,1],[0,1],[1,1]],color:C.purple},{shape:[[1,0,0],[1,1,1]],color:C.purple},{shape:[[1,1],[0,1],[0,1]],color:C.pink},{shape:[[0,0,1],[1,1,1]],color:C.pink},{shape:[[1,1],[1,1],[0,1,0]],color:C.cyan},{shape:[[0,0,1],[1,1,1]],color:C.cyan},{shape:[[1,1,1],[0,1,0]],color:C.blue},{shape:[[0,1],[1,1],[0,1]],color:C.blue},{shape:[[1,1,0],[0,1,1]],color:C.green},{shape:[[0,1,1],[1,1,0]],color:C.green}]];const CB=[0,20,30,40,50,60,70,80,90,100];let grid=Array(G).fill(null).map(()=>Array(G).fill(null));let score=0,highScore=localStorage.highScore||0;let cur=[];let dragP=null,dragI=-1,ghost=null;const cvs=document.getElementById('canvas');const ctx=cvs.getContext('2d');function init(){document.getElementById('best').textContent=highScore;spawnPieces();drawGrid();requestAnimationFrame(gameLoop);}function spawnPieces(){cur=[];document.getElementById('pieces').innerHTML='';for(let i=0;i<3;i++){const pc=P[0][Math.floor(Math.random()*P[0].length)];cur.push(pc);const slot=document.createElement('div');slot.className='piece-slot';slot.id='slot'+i;const c=document.createElement('canvas');const rows=pc.shape.length,cols=pc.shape[0].length;c.width=cols*15;c.height=rows*15;c.dataset.idx=i;drawPiece(c.getContext('2d'),pc.shape,pc.color,15);c.style.cursor='grab';c.addEventListener('mousedown',startDrag);c.addEventListener('touchstart',startDrag,{passive:false});slot.appendChild(c);document.getElementById('pieces').appendChild(slot);}}function drawPiece(cx,shape,color,size){shape.forEach((r,y)=>r.forEach((c,x)=>{if(c){cx.fillStyle=color;cx.fillRect(x*size+1,y*size+1,size-2,size-2);}}));}function drawGrid(){ctx.fillStyle='#1e293b';ctx.fillRect(0,0,320,320);for(let y=0;y<G;y++){for(let x=0;x<G;x++){const px=x*CS,py=y*CS;if(grid[y][x]){ctx.fillStyle=grid[y][x];ctx.fillRect(px+1,py+1,CS-2,CS-2);}else{ctx.fillStyle='rgba(255,255,255,0.03)';ctx.fillRect(px+1,py+1,CS-2,CS-2);}}}if(ghost&&dragP){ctx.fillStyle=ghost.valid?'rgba(0,255,100,0.25)':'rgba(255,60,60,0.25)';dragP.shape.forEach((r,y)=>r.forEach((c,x)=>{if(c){const gx=(ghost.col+x)*CS,gy=(ghost.row+y)*CS;if(gy>=0&&gy<G&&gx>=0&&gx<G)ctx.fillRect(gx+2,gy+2,CS-4,CS-4);}}));}}function gameLoop(){drawGrid();requestAnimationFrame(gameLoop);}function startDrag(e){e.preventDefault();const c=e.target;dragI=parseInt(c.dataset.idx);dragP=cur[dragI];if(!dragP)return;const t=e.touches?e.touches[0]:e;const dc=document.createElement('canvas');dc.className='dragging';dc.width=dragP.shape[0].length*CS;dc.height=dragP.shape.length*CS;dc.style.cssText='position:fixed;pointer-events:none;z-index:1000;opacity:0.85';dc.style.left=(t.clientX-dc.width/2)+'px';dc.style.top=(t.clientY-dc.height/2)+'px';const dx=dc.getContext('2d');drawPiece(dx,dragP.shape,dragP.color,CS);document.body.appendChild(dc);if(c.parentElement)c.parentElement.style.opacity='0';updateGhost(t.clientX,t.clientY);}function onDrag(e){if(!dragP)return;e.preventDefault();const t=e.touches?e.touches[0]:e;const dc=document.querySelector('.dragging');if(dc){dc.style.left=(t.clientX-dc.width/2)+'px';dc.style.top=(t.clientY-dc.height/2)+'px';}updateGhost(t.clientX,t.clientY);}function updateGhost(cx,cy){const r=cvs.getBoundingClientRect();const pw=dragP.shape[0].length*CS,ph=dragP.shape.length*CS;const col=Math.round((cx-r.left-pw/2)/CS);const row=Math.round((cy-r.top-ph/2)/CS);ghost={col,row,valid:canPlace(dragP.shape,row,col)};}function onDrop(e){const dc=document.querySelector('.dragging');if(ghost&&ghost.valid){placePiece(dragP,ghost.row,ghost.col);cur[dragI]=null;const slot=document.getElementById('slot'+dragI);if(slot)slot.style.visibility='hidden';const cleared=checkLines();if(cleared>0)showCombo(cleared);if(cur.every(p=>p===null))setTimeout(spawnPieces,300);}if(dc)dc.remove();ghost=null;dragP=null;dragIdx=-1;}function canPlace(shape,row,col){for(let y=0;y<shape.length;y++){for(let x=0;x<shape[0].length;x++){if(shape[y][x]){if(row+y<0||row+y>=G||col+x<0||col+x>=G)return false;if(grid[row+y][col+x])return false;}}return true;}return true;}function placePiece(piece,row,col){piece.shape.forEach((r,y)=>r.forEach((c,x)=>{if(c)grid[row+y][col+x]=piece.color;}));}function checkLines(){let rows=[],cols=[];for(let y=0;y<G;y++)if(grid[y].every(c=>c!==null))rows.push(y);for(let x=0;x<G;x++){let full=true;for(let y=0;y<G;y++)if(!grid[y][x])full=false;if(full)cols.push(x);}const total=rows.length+cols.length;if(total===0)return 0;let blocks=0;rows.forEach(y=>{for(let x=0;x<G;x++)if(grid[y][x])blocks++;});cols.forEach(x=>{for(let y=0;y<G;y++)if(grid[y][x]&&!rows.includes(y))blocks++;});rows.forEach(y=>{for(let x=0;x<G;x++)grid[y][x]=null;});cols.forEach(x=>{for(let y=0;y<G;y++)grid[y][x]=null;});score+=blocks*10+CB[Math.min(total,9)]||100;document.getElementById('score').textContent=score;if(score>highScore){highScore=score;localStorage.highScore=highScore;document.getElementById('best').textContent=highScore;}return total;}function showCombo(lines){const combo=document.getElementById('combo');const texts=['','NICE!','GOOD!','GREAT!','AWESOME!','INCREDIBLE!'];combo.textContent=texts[Math.min(lines,5)]+(lines>1?' x'+lines:'')+' +'+CB[Math.min(lines,9)];combo.classList.add('show');setTimeout(()=>combo.classList.remove('show'),1000);}document.addEventListener('mousemove',onDrag);document.addEventListener('mouseup',onDrop);document.addEventListener('touchmove',onDrag,{passive:false});document.addEventListener('touchend',onDrop);window.addEventListener('load',init);</script></body></html>"""
def ap():
  w=network.WLAN(network.AP_IF)
  w.active(True)
  w.config(essid=SSID,password="")
  while not w.active():pass
  print("Connect: http://"+w.ifconfig()[0])
  return w.ifconfig()[0]
def sv(c):
  try:
    c.send(b"HTTP/1.1 200 OK\r\n\r\n"+HTML)
  except:pass
  c.close()
ip=ap()
s=socket.socket()
s.setsockopt(socket.SOL_SOCKET,socket.SO_REUSEADDR,1)
s.bind(("",80))
s.listen(2)
gc.collect()
while 1:
  try:
    c,a=s.accept()
    c.recv(100)
    gc.collect()
    sv(c)
  except:pass
